apiVersion: metaspore/v1
kind: TrainingJob
metadata:
  name: ItemCF
  category: Match/I2I/ItemCF

spec:
  logging:
    loglevel: debug
  
  spark:
    session_confs:
      app_name: 'I2I Pipeline Demo'
      local: False
      worker_count: 4
      worker_cpu: 4
      server_count: 4
      server_cpu: 4
      batch_size: 256
      worker_memory: '10G'
      server_memory: '10G'
      coordinator_memory: '10G'

    extended_confs:
      spark.network.timeout: '500'
      spark.ui.showConsoleProgress: 'true'
      spark.kubernetes.executor.deleteOnTermination: 'true'
      spark.jars.packages: 'org.mongodb.spark:mongo-spark-connector_2.12:3.0.1'
  
    pyzip:
      cwd_path: '/home/spark/work/MetaSpore/'
      zip_file_path: '/home/spark/work/MetaSpore/solutions/recommend/offline/python.zip'
  
  dataset:
    train_path: s3://dmetasoul-bucket/demo/movielens/1m/negsample/num_negs_10/train.parquet
    test_path: s3://dmetasoul-bucket/demo/movielens/1m/negsample/num_negs_10/test.parquet
    # user_id_column: user_id
    # item_id_column: movie_id
    # label_column: label
    # label_value: '1'
    # last_item_id_column: last_movie
  
  training:
    i2i_estimator_class: python.algos.item_cf_retrieval.ItemCFEstimator
    # i2i_estimator_class: metaspore.SwingEstimator
    model_out_path: s3://dmetasoul-bucket/demo/movielens/1m/model/cf/model_out/df.parquet
    estimator_params:
      max_recommendation_count: 20
  
  mongodb:
    uri: mongodb://172.31.37.47:27017/
    database: jpa
    collection: movlens1m_itemcf
    write_mode: overwrite
    index_fields: []
    index_unique: False
  
