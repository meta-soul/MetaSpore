WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.apache.spark.unsafe.Platform (file:/opt/spark/jars/spark-unsafe_2.12-3.1.2.jar) to constructor java.nio.DirectByteBuffer(long,int)
WARNING: Please consider reporting this to the maintainers of org.apache.spark.unsafe.Platform
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release
22/04/27 02:19:22 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
Using Spark's default log4j profile: org/apache/spark/log4j-defaults.properties
Setting default log level to "WARN".
To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).

[Stage 0:>                                                                                                                                                                              (0 + 1) / 1]

                                                                                                                                                                                                    

[Stage 1:>                                                                                                                                                                              (0 + 1) / 1]

                                                                                                                                                                                                    

[Stage 2:>                                                                                                                                                                              (0 + 1) / 1]

                                                                                                                                                                                                    

[Stage 3:>                                                                                                                                                                              (0 + 1) / 1]

                                                                                                                                                                                                    

[Stage 4:>                                                                                                                                                                              (0 + 8) / 8]

[Stage 4:=====================>                                                                                                                                                         (1 + 7) / 8]

[Stage 4:===========================================>                                                                                                                                   (2 + 6) / 8]

[Stage 4:=================================================================>                                                                                                             (3 + 5) / 8]

[Stage 4:=======================================================================================>                                                                                       (4 + 4) / 8]

[Stage 4:=============================================================================================================>                                                                 (5 + 3) / 8]

[Stage 4:===================================================================================================================================>                                           (6 + 2) / 8]

[Stage 4:=========================================================================================================================================================>                     (7 + 1) / 8]

                                                                                                                                                                                                    

[Stage 6:>                                                                                                                                                                              (0 + 8) / 8]

[Stage 6:=====================>                                                                                                                                                         (1 + 7) / 8]

[Stage 6:===========================================>                                                                                                                                   (2 + 6) / 8]

[Stage 6:=================================================================>                                                                                                             (3 + 5) / 8]

[Stage 6:=======================================================================================>                                                                                       (4 + 4) / 8]

[Stage 6:=============================================================================================================>                                                                 (5 + 3) / 8]

[Stage 6:===================================================================================================================================>                                           (6 + 2) / 8]

[Stage 6:=========================================================================================================================================================>                     (7 + 1) / 8]

                                                                                                                                                                                                    

[Stage 8:>                                                                                                                                                                              (0 + 8) / 8]

[Stage 8:=====================>                                                                                                                                                         (1 + 7) / 8]

[Stage 8:===========================================>                                                                                                                                   (2 + 6) / 8]

[Stage 8:=======================================================================================>                                                                                       (4 + 4) / 8]

[Stage 8:=============================================================================================================>                                                                 (5 + 3) / 8]

[Stage 8:=========================================================================================================================================================>                     (7 + 1) / 8]

                                                                                                                                                                                                    

[Stage 10:>                                                                                                                                                                             (0 + 8) / 8]

[Stage 10:=====================>                                                                                                                                                        (1 + 7) / 8]

[Stage 10:===========================================>                                                                                                                                  (2 + 6) / 8]

[Stage 10:=================================================================>                                                                                                            (3 + 5) / 8]

[Stage 10:=======================================================================================>                                                                                      (4 + 4) / 8]

[Stage 10:==================================================================================================================================>                                           (6 + 2) / 8]

                                                                                                                                                                                                    

[Stage 13:>                                                                                                                                                                             (0 + 8) / 8]

[Stage 13:=====================>                                                                                                                                                        (1 + 7) / 8]

[Stage 13:===========================================>                                                                                                                                  (2 + 6) / 8]

[Stage 13:=======================================================================================>                                                                                      (4 + 4) / 8]

[Stage 13:========================================================================================================================================================>                     (7 + 1) / 8]

                                                                                                                                                                                                    
Debug -- Global Hot Recall Demo
Debug -- load config:  {'app_name': 'Global Hot', 'local': False, 'worker_count': 4, 'server_count': 4, 'batch_size': 512, 'worker_memory': '10G', 'server_memory': '10G', 'coordinator_memory': '10G', 'train_path': '${MY_S3_BUCKET}/movielens/1m/cf/train.parquet', 'test_path': '${MY_S3_BUCKET}/movielens/1m/negsample/num_negs_10/test.parquet', 'max_recommendation_count': 20}
Debug -- spark init
Debug -- version: 3.1.2
Debug -- applicaitonId: spark-application-1651025963804
Debug -- uiWebUrl: http://jupyter.my.nginx.test/hub/user-redirect/proxy/4040/jobs/
Debug -- match train dataset sample:
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+----------+-----------------+---------+
|label|user_id|gender|age|occupation|  zip|movie_id|    recent_movie_ids|               genre|last_movie|       last_genre|timestamp|
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+----------+-----------------+---------+
|    1|   5057|     M| 50|         7|84093|    2571|1617296608456...|ActionSci-FiThr...|      3499|           Horror|962485259|
|    1|     90|     M| 56|        13|85749|      34|28112332997527...|Children'sComedy...|      1704|            Drama|993872315|
|    1|   5046|     M| 25|        16|60614|     589|12981275308731...|ActionSci-FiThr...|      3265|     ActionCrime|962504960|
|    1|   5005|     M| 45|        16|92807|    1083|20991029208158...|      ComedyMusical|      2135|AdventureMusical|962588244|
|    1|   3435|     M| 45|         1|48867|    1266|90437309131086...|             Western|      2401|          Western|970793764|
|    1|   5814|     M| 25|         0|91403|    1617|   26402459231027|CrimeFilm-NoirM...|      1027|            Drama|957915423|
|    1|    549|     M| 25|         6|53217|    2183|32042764342019...|            Thriller|      1824|  ComedyThriller|976116360|
|    1|   5738|     M| 25|        12|55406|    1944|20343032261528...|   DramaRomanceWar|      1939|        DramaWar|958418448|
|    1|   5335|     M| 25|        14|75093|    1022|22330602406200...|AnimationChildre...|      2917|   CrimeThriller|960765375|
|    1|   1354|     F| 25|         2|94040|    1584|26153416503260...|        DramaSci-Fi|      3255|     ComedyDrama|978298377|
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+----------+-----------------+---------+
only showing top 10 rows

Debug -- match test dataset sample:
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+----------+---------------+
|label|user_id|gender|age|occupation|  zip|movie_id|    recent_movie_ids|               genre|last_movie|     last_genre|
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+----------+---------------+
|    1|   4029|     F| 56|         3|21114|    1267|36061282359991...|  Film-NoirThriller|      1219|HorrorThriller|
|    1|    758|     M| 35|         7|19518|      32|1101179362291...|        DramaSci-Fi|      3255|   ComedyDrama|
|    1|   3904|     M|  1|        10|48445|    3717|22312005120528...|        ActionCrime|      3617|         Comedy|
|    1|    183|     F| 45|         1|55407|    2076|13952105261630...|       DramaMystery|      1081| ComedyMusical|
|    1|   1803|     M| 25|         2|50021|    1367|2012104725395...|   Children'sComedy|      1441| ComedyRomance|
|    1|    207|     M| 25|        12|94115|    2399|37511442160375...|AdventureChildre...|       804| ComedyRomance|
|    1|   4806|     M| 25|        17|90031|    2408|18520382642205...|       ComedySci-Fi|       256|  ComedySci-Fi|
|    1|   5187|     M| 18|        16|06510|    1077|31620127882393...|       ComedySci-Fi|      1527|  ActionSci-Fi|
|    1|   2340|     M| 35|         2|48104|    3168|15913603268926...|     AdventureDrama|      1132|          Drama|
|    1|   5280|     M| 18|         4|12604|    2712|31252997295929...|               Drama|      3005|       Thriller|
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+----------+---------------+
only showing top 10 rows

Debug -- train dataset positive count: 982089
Debug -- train dataset negative count: 0
Debug -- test dataset count: 15000
Debug -- globalhot@top20:
+--------+-----+
|movie_id|count|
+--------+-----+
|    2858| 3370|
|    1196| 2966|
|     260| 2951|
|    1210| 2854|
|     480| 2632|
|    2028| 2624|
|     589| 2609|
|    2571| 2558|
|    1270| 2551|
|     593| 2538|
|    1580| 2489|
|    1198| 2489|
|     608| 2463|
|     110| 2410|
|    2762| 2385|
|    2396| 2308|
|    1197| 2286|
|     527| 2272|
|    1617| 2239|
|    1097| 2239|
+--------+-----+

Debug -- test result sample:

[Stage 17:>                                                                                                                                                                             (0 + 8) / 8]

[Stage 17:=====================>                                                                                                                                                        (1 + 7) / 8]

[Stage 17:=======================================================================================>                                                                                      (4 + 4) / 8]

[Stage 17:============================================================================================================>                                                                 (5 + 3) / 8]

[Stage 17:==================================================================================================================================>                                           (6 + 2) / 8]

                                                                                                                                                                                                    

[Stage 20:>                                                                                                                                                                             (0 + 1) / 1]

                                                                                                                                                                                                    

[Stage 21:>                                                                                                                                                                             (0 + 8) / 8]

[Stage 21:=====================>                                                                                                                                                        (1 + 7) / 8]

[Stage 21:===========================================>                                                                                                                                  (2 + 6) / 8]

[Stage 21:=======================================================================================>                                                                                      (4 + 4) / 8]

[Stage 21:============================================================================================================>                                                                 (5 + 3) / 8]

[Stage 21:==================================================================================================================================>                                           (6 + 2) / 8]

[Stage 21:========================================================================================================================================================>                     (7 + 1) / 8]

                                                                                                                                                                                                    

[Stage 22:>                                                                                                                                                                             (0 + 8) / 8]

[Stage 22:===========================================>                                                                                                                                  (2 + 6) / 8]

[Stage 22:=======================================================================================>                                                                                      (4 + 4) / 8]

[Stage 22:==================================================================================================================================>                                           (6 + 2) / 8]

[Stage 22:========================================================================================================================================================>                     (7 + 1) / 8]

                                                                                                                                                                                                    

[Stage 23:>                                                                                                                                                                             (0 + 8) / 8]

[Stage 23:=====================>                                                                                                                                                        (1 + 7) / 8]

[Stage 23:=================================================================>                                                                                                            (3 + 5) / 8]

[Stage 23:============================================================================================================>                                                                 (5 + 3) / 8]

[Stage 23:==================================================================================================================================>                                           (6 + 2) / 8]

[Stage 23:========================================================================================================================================================>                     (7 + 1) / 8]

                                                                                                                                                                                                    

[Stage 24:>                                                                                                                                                                             (0 + 8) / 8]

[Stage 24:=====================>                                                                                                                                                        (1 + 7) / 8]

[Stage 24:===========================================>                                                                                                                                  (2 + 6) / 8]

[Stage 24:==================================================================================================================================>                                           (6 + 2) / 8]

[Stage 24:========================================================================================================================================================>                     (7 + 1) / 8]

                                                                                                                                                                                                    
22/04/27 02:26:01 WARN ExecutorPodsWatchSnapshotSource: Kubernetes client has been closed (this is expected if the application is shutting down.)
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+----------+--------------------+--------------------+
|label|user_id|gender|age|occupation|  zip|movie_id|    recent_movie_ids|               genre|last_movie|          last_genre|          prediction|
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+----------+--------------------+--------------------+
|    1|   4029|     F| 56|         3|21114|    1267|36061282359991...|  Film-NoirThriller|      1219|     HorrorThriller|[2858, 1196, 260,...|
|    1|    758|     M| 35|         7|19518|      32|1101179362291...|        DramaSci-Fi|      3255|        ComedyDrama|[2858, 1196, 260,...|
|    1|   3904|     M|  1|        10|48445|    3717|22312005120528...|        ActionCrime|      3617|              Comedy|[2858, 1196, 260,...|
|    1|    183|     F| 45|         1|55407|    2076|13952105261630...|       DramaMystery|      1081|      ComedyMusical|[2858, 1196, 260,...|
|    1|   1803|     M| 25|         2|50021|    1367|2012104725395...|   Children'sComedy|      1441|      ComedyRomance|[2858, 1196, 260,...|
|    1|    207|     M| 25|        12|94115|    2399|37511442160375...|AdventureChildre...|       804|      ComedyRomance|[2858, 1196, 260,...|
|    1|   4806|     M| 25|        17|90031|    2408|18520382642205...|       ComedySci-Fi|       256|       ComedySci-Fi|[2858, 1196, 260,...|
|    1|   5187|     M| 18|        16|06510|    1077|31620127882393...|       ComedySci-Fi|      1527|       ActionSci-Fi|[2858, 1196, 260,...|
|    1|   2340|     M| 35|         2|48104|    3168|15913603268926...|     AdventureDrama|      1132|               Drama|[2858, 1196, 260,...|
|    1|   5280|     M| 18|         4|12604|    2712|31252997295929...|               Drama|      3005|            Thriller|[2858, 1196, 260,...|
|    1|   3996|     M| 18|        14|32825|    3793|13591692355364...|       ActionSci-Fi|      1126|      ComedyFantasy|[2858, 1196, 260,...|
|    1|   3627|     F| 35|         1|85287|    3632|22472302229032...|              Comedy|      3176|DramaMysteryThr...|[2858, 1196, 260,...|
|    1|   1542|     M| 18|        17|12054|    2918|16172501608124...|              Comedy|      2716|       ComedyHorror|[2858, 1196, 260,...|
|    1|   3910|     M| 25|        20|91505|    1952|16179229131252...|               Drama|       608|CrimeDramaThriller|[2858, 1196, 260,...|
|    1|   3472|     M| 25|         6|33156|    1285|12891266151734...|              Comedy|      2194|  ActionCrimeDrama|[2858, 1196, 260,...|
|    1|   3139|     M| 56|        13|89128|    3408|12173811307231...|               Drama|      3148|               Drama|[2858, 1196, 260,...|
|    1|   1828|     M| 18|         4|07030|    3173|52711037513752...|               Drama|      3327|         Documentary|[2858, 1196, 260,...|
|    1|   5343|     F| 25|         9|60201|    2078|31141023594595...|AnimationChildre...|      2081|AnimationChildre...|[2858, 1196, 260,...|
|    1|   1452|     F| 56|        13|90732|    3897|19612012371377...|        ComedyDrama|      3912|        ComedyDrama|[2858, 1196, 260,...|
|    1|   2670|     M| 35|         6|94598|     150|12471206926120...|               Drama|       593|      DramaThriller|[2858, 1196, 260,...|
+-----+-------+------+---+----------+-----+--------+--------------------+--------------------+----------+--------------------+--------------------+
only showing top 20 rows

Debug -- Precision@20: 0.002477
Debug -- Recall@20: 0.049533
Debug -- MAP@20: 0.008923
Debug -- NDCG@20: 0.017346
Debug -- spark stop
